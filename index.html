<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏à‡∏±‡∏î‡∏à‡πâ‡∏≤‡∏á</title>
</head>
<body>
  <h2>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (CGDContract)</h2>

  <label>‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì:</label>
  <input type="number" id="year" value="2568"><br><br>

  <label>Keyword:</label>
  <input type="text" id="keyword" value="‡∏û‡∏≤‡∏´‡∏ô‡∏∞"><br><br>

  <button onclick="searchProjects()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>

  <pre id="log"></pre>

  <script>
    async function searchProjects() {
      const apiKey = "AebJrhT78gJiFGwhjY3tmjnNay9qXqCZ"; // ‡πÉ‡∏™‡πà key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
      const year = document.getElementById("year").value;
      const keyword = document.getElementById("keyword").value;
      const limit = 20;  // fix ‡πÑ‡∏ß‡πâ

      const url = `https://govspending.data.go.th/api/service/cgdcontract?api-key=${apiKey}&year=${year}&keyword=${encodeURIComponent(keyword)}&limit=${limit}`;

      document.getElementById("log").textContent = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...\n" + url;

      try {
        const res = await fetch(url);
        const data = await res.json();

        console.log(data); // log ‡πÉ‡∏ô browser console
        document.getElementById("log").textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        document.getElementById("log").textContent = "‚ùå Error: " + err;
      }
    }
  </script>
</body>
</html>

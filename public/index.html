<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ CGDContract (‡∏ú‡πà‡∏≤‡∏ô Netlify Function)</title>
</head>
<body>
  <h2>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h2>
  <label>‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì:</label>
  <input type="number" id="year" value="2568"><br><br>

  <label>Keyword:</label>
  <input type="text" id="keyword" value="1"><br><br>

  <button id="btn">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
  <pre id="out">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</pre>

<script>
document.getElementById('btn').addEventListener('click', async () => {
  const year = document.getElementById('year').value || '2568';
  const keyword = document.getElementById('keyword').value || '‡∏û‡∏≤‡∏´‡∏ô‡∏∞';
  const limit = 20;

  // ‚úÖ ‡πÉ‡∏ä‡πâ relative path + URLSearchParams ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
  const params = new URLSearchParams({
    path: 'cgdcontract',
    year,
    keyword,
    limit
  });

  const url = '/api/govspending?' + params.toString();

  const out = document.getElementById('out');
  out.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...\n' + url;

  try {
    const res = await fetch(url, { headers: { Accept: 'application/json' } });
    const data = await res.json();
    out.textContent = JSON.stringify(data, null, 2);
  } catch (e) {
    out.textContent = '‚ùå ' + e;
  }
});
</script>
</body>
</html>